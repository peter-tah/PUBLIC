## Upgrade States and Terminology

* **Source BOM**

  - Prior to initiating the upgrade all components are at VMware Cloud Foundation 4.5.x, 5.0, or 5.1.
* **SDDC Manager only**

  - You have updated SDDC Manager to 5.2, but none of the other BOM components.
* **Split BOM**

  - Management domain or VI Workload Domain is only partially updated to VMware Cloud Foundation 5.2.
* **Mixed 4.5.x/5.x BOM**

  - Some workload domains (Management or VI) have been completely upgraded to VMware Cloud Foundation 5.2 and at least one VI Workload Domain is at the Source 4.5.x BOM version.
* M**ixed 5.x BOM**

  - Some workload domains (Management or VI) have been completely upgraded to VMware Cloud Foundation 5.2 and at least one VI Workload Domain is at the Source 5.0 or 5.1 BOM version.
* **Target BOM**

  - All components are at VMware Cloud Foundation 5.2.


#

# Update Precheck - Versions Prior to SDDC Manager 5.0

If the workload domain contains a host that includes pinned VMs, the precheck fails at the Enter Maintenance Mode step. If the host can enter maintenance mode through vCenter Server UI, you can suppress this check for NSX and ESXi in VMware Cloud Foundation by following the steps below.

* * Log in to SDDC Manager by using a Secure Shell (SSH) client with the user name vcf and password you specified in the deployment parameter workbook.
  * Open the **/opt/vmware/vcf/lcm/lcm-app/conf/application-prod.properties** ile.
  * Add the following line to the end of the file:

    **lcm.nsxt.suppress.dry.run.emm.check=true**

    **lcm.esx.suppress.dry.run.emm.check.failures=true**
  * Restart Lifecycle Management by typing the following command in the console window.
    **systemctl restart lcm**
  * After Lifecycle Management is restarted, run the precheck again.



# Apply the VMware Cloud Foundation  5.2.x Upgrade Bundle


After SDDC Manager  is upgraded to 5.2 or later, new functionality is introduced that allows you to upgrade SDDC Manager  without having to upgrade the entire VMware Cloud Foundation  BOM. See [Independent SDDC Manager Upgrade using the SDDC Manager UI](https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/upgrade-sddc-manager-without-upgrading-vcf.html).

1. In the navigation pane, click Inventory Workload Domains
2. On the Workload Domains page, click the management domain and then click the Updates tab.
3. In the Available Updates section, select the target VMware Cloud Foundationrelease or click Plan Upgrade
4. click Plan Upgrade select a target version, and click Confirm
5. Click Update Now or Schedule Update

.

# Upgrade VMware Aria Suite Lifecycle  and VMware Aria Suite  Products for VMware Cloud Foundation

VMware Cloud Foundation does not manage upgrades for VMware Aria Suite Lifecycle and the VMware Aria Suite products. Use VMware Aria Suite Lifecycle to upgrade VMware Aria Suite products.
If you had VMware Aria Suite Lifecycle, VMware Aria Operations for Logs, VMware Aria Automation, VMware Aria Operations, or Workspace ONE Access in your pre-upgrade environment, you must upgrade them from VMware Aria Suite Lifecycle.

- Use VMware Aria Suite Lifecycle to:
- Download upgrade binariesCreate snapshots of the virtual appliances
- Run pre-upgrade checks
- Upgrade VMware Aria Suite products

1. Log in to VMware Aria Suite Lifecycle at https://<aria_suite_lifecycle_manager_fqdn> as the administrator.
2. Upgrade VMware Aria Suite products.
3. Upgrade VMware Aria Suite Lifecycle first and then upgrade VMware Aria Suite products.



# Flexible BOM Upgrade in VMware Cloud Foundation

 Once SDDC Manager is upgraded to version 5.2 or later, new functionality is introduced to the upgrade planner that allows you to select specific target versions for each VMware Cloud Foundation component you want to upgrade.

- Download the bundles for the target versions of each VCF component. See Downloading VMware Cloud Foundation Upgrade Bundles.
- SDDC Manager must be version 5.2 or later.
  You can use the upgrade planner to select any supported version for each of the VMware Cloud Foundation BOM components. This includes async patch versions as well as VCF BOM versions.

# Patching the Management and Workload Domains

Once SDDC Manager is upgraded to 5.2 or later, a new option for patching VMware Cloud Foundation components is available in the SDDC Manager UI.

- Download the async patch bundles: https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/vmware-cloud-foundation-lifecycle-management/downloading-vmware-cloud-foundation-bundles-lifecycle.html
- SDDC Manager must be version 5.2 or later.
  The patch planner provides the ability to apply async patches to workload domain components. If you are connected to the online depot, async patches are available in the patch planner. If you do not have access to the online depot, use the Bundle Transfer Utility to download async patches and add them to an offline depot or upload them directly to SDDC Manager.
- To plan an upgrade when SDDC Manager does not have internet access, seehttps://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/offline-download-of-async-patches.html


# Upgrade NSX  for VCF in Federated environment

If NSX Federation is configured between two VMware Cloud Foundation instances, SDDC Manager does not manage the lifecycle of the NSX Global Managers. You must manually upgrade the NSX Global Managers for each instance.
	- Download NSX Global Manager Upgrade Bundle
	- Log in to the Broadcom Support Portal and browse to My Downloads > VMware NSX> select Version.
	- Locate the NSX version Upgrade Bundle and verify that the upgrade bundle filename extension ends with .mub.
	- The upgrade bundle filename format VMware-NSX-upgrade-bundle-versionnumber.buildnumber.mub.


1. Upgrade the Upgrade Coordinator for NSX Federation
   SystemUpgrade from the navigation panel > Click Proceed to Upgrade> Click Browse > Upload > Begin Upgrade
   Click Run Pre-Checks to verify that all NSX components are ready for upgrade.


2. Upgrade NSX Global Managers
   System > Upgrade  > STart > Accept > PPlan Your Upgrade > Next

# Log Files

## - navigate to the /var/log/vmware/vcf/lcm

- lcm-debug 	# log file contains debug level logging information.

* lcm.log 			# contains information level logging.



# Software Depot for Downloading Bundles

SDDC Manager supports two types of software depots:

- Online depot

* Offline depot
* click Lifecycle Management > Bundle Management > Click the Bundles
* tab to view available bundles.


## Upgrade the components in the management domain in the following order:

* SDDC Manager and VMware Cloud Foundation ervices.
* VMware Aria Suite Lifecycle
* NSX Manager and NSX Global Managers (if applicable).
* vCenter Server
* VxRail Manager and ESXi

  .After all upgrades have completed successfully:

  * Remove the VM snapshots you took before starting the update.
  * Take a backup of the newly installed components.
